---
import Layout from '@/layouts/Layout.astro'

import { useDato, addLinkAttrs } from '@/lib/utils'

import type { CmsIndex } from '@/lib/types'

export const prerender = true

const { data, error } = await useDato<CmsIndex>(/* GraphQL */ `
   {
      home {
         seo {
            title
            description
         }
         title(markdown: true)
         sections {
            title
            text(markdown: true)
         }
      }
   }
`)

if (error) throw new Error(error)

const cms = data.home
---

<Layout title={cms.seo.title} description={cms.seo.description} isArticleLayout>
   <article class="G_Prose G_Article_Wrapper Wrapper">
      <div class="G_Hero_Title Hero_Title" set:html={cms.title} />

      {
         cms.sections.map((s) => (
            <section>
               <h2>{s.title}</h2>
               <Fragment set:html={addLinkAttrs(s.text)} />
            </section>
         ))
      }
   </article>
</Layout>

<style>
   .Wrapper {
      margin-top: var(--header-height);
   }

   .Hero_Title {
      max-width: 25ch;
   }
</style>
